import timefrom selenium import webdriverfrom selenium.webdriver.common.by import Byfrom selenium.webdriver.support.ui import WebDriverWaitfrom selenium.webdriver.support import expected_conditions as ECfrom selenium.common.exceptions import TimeoutExceptionfrom selenium.common.exceptions import StaleElementReferenceExceptionimport MySQLdburl = 'http://rochester.nydatabases.com/database/real-estate-database'countyName = ""def init_driver():    driver = webdriver.Firefox()    driver.wait = WebDriverWait(driver, 5)    return driverdef load(driver):    driver.get(url)    try:        button = driver.wait.until(EC.element_to_be_clickable(            (By.ID, "search")))        button.click()    except TimeoutException:        print("Button not found")def nextPage(driver, current):    try:        button = driver.wait.until(EC.element_to_be_clickable(            (By.XPATH, '//span[@start={0}]'.format(str(current)))))        button.click()        time.sleep(4)        return(current+1)    except TimeoutException:        print("No more pages found")        return(current)def newYear(driver, current):    try:        button = driver.wait.until(EC.element_to_be_clickable(            (By.XPATH, '//select[@id="sYear"]/option[@value={0}]'.format(str(current-1)))))        button.click()        search = driver.wait.until(EC.element_to_be_clickable(            (By.ID, "search")))        search.click()        time.sleep(4)        return(current-1)    except TimeoutException:        print("No more years")        return(current)def newCounty(driver, current):    try:        counties = driver.find_elements_by_xpath('//select[@id="cnty"]')        for county in counties:            names = county.find_elements_by_tag_name('option')            global countyName            countyName = [name.text for name in names][current-1]        button = driver.wait.until(EC.element_to_be_clickable(            (By.XPATH, '//select[@id="cnty"]/option[@value={0}]'.format(str(current)))))        button.click()        search = driver.wait.until(EC.element_to_be_clickable(            (By.ID, "search")))        search.click()        time.sleep(4)        return(current+1)    except TimeoutException:        print("No more counties")        return(current)if __name__ == "__main__":    driver = init_driver()    load(driver)    time.sleep(5)    county = newCounty(driver, 5)    db = MySQLdb.connect(user="root", passwd="stat231project", db="nyhousing", host="localhost")    cur = db.cursor()    db.set_character_set('utf8')    cur.execute('SET NAMES utf8;')    cur.execute('SET CHARACTER SET utf8;')    cur.execute('SET character_set_connection=utf8;')    while True:        curyear = newYear(driver, 2018)        if(county == 6):            curyear = newYear(driver, 2014)        while True:            pagenum = 1            while True:                data = []                trs = driver.find_elements_by_tag_name('tr')                if trs:                    for tr in trs:                        tds = tr.find_elements_by_tag_name('td')                        if tds:                            text = []                            text.append(countyName)                            for td in tds:                                text.append(td.text)                            data.append(text)                cur.executemany("INSERT INTO transactions (County, Town, Address, ZipCode, SalePrice, SaleDate, SellerName, BuyerName) VALUES (%s, %s, %s, %s, %s, %s, %s, %s)", data)                print "County: {} Year: {} Page: {}".format(county, curyear, pagenum)                newpage = nextPage(driver, pagenum)                if (newpage > pagenum):                    pagenum = newpage                else:                    break            db.commit()            newyear = newYear(driver, curyear)            if (newyear < curyear):                curyear = newyear            else:                break        newcounty = newCounty(driver, county)        if(newcounty > county):            county = newcounty        else:            break    driver.quit()    cur.close()    db.close()